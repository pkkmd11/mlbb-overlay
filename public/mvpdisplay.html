<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MVP Display - Cyber HUD</title>
    <style>
        /* --- FONTS & VARS --- */
        @font-face { font-family: 'Big Noodle Titling'; src: url('Assets/Font/Renegade\ Pursuit.otf') format('truetype'); }

        :root {
            --primary: #FFD600; /* Cyber Yellow */
            --dark-bg: #0a0b10;
            --panel-bg: rgba(16, 20, 30, 0.95);
            --blue-team: #00F0FF;
            --red-team: #FF003C;
            --text-white: #ffffff;
            --angle: -10deg; /* Kemiringan global */
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Big Noodle Titling', sans-serif;
            width: 1920px;
            height: 1080px;
            overflow: hidden;
            background: #000;            color: var(--text-white);
        }

        /* --- BACKGROUND & GRID FX --- */
        .viewport {
            width: 100%; height: 100%;
            position: relative;

            background-size: cover;
            display: flex; /* Default hidden via JS */
        }

        /* Overlay Grid Pattern yang bergerak */
        .tech-grid {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: 
                linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%),
                linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 2px, 3px 100%;
            z-index: 0;
            pointer-events: none;
        }

        /* --- BIG "MVP" WATERMARK --- */
        .big-watermark {
            position: absolute;
            top: 50px;
            left: -50px;
            font-size: 500px;
            font-weight: bold;
            font-style: italic;
            color: rgba(255, 255, 255, 0.03);
            z-index: 1;
            letter-spacing: -20px;
            pointer-events: none;
            text-shadow: 0 0 50px rgba(255,255,255,0.1);
        }

        /* --- CONTENT WRAPPER --- */
        .content-layer {
            position: relative;
            z-index: 10;
            width: 100%;
            height: 100%;
            display: flex;
        }

        /* --- LEFT PANEL (STATS) --- */
        .stats-panel {
            width: 55%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding-left: 100px;
            position: relative;
        }

        /* Container utama stats yang miring */
        .hud-container {
            transform: skewX(var(--angle));
            background: var(--panel-bg);
            border-left: 15px solid var(--primary);
            padding: 40px 60px;
            position: relative;
            box-shadow: 20px 20px 50px rgba(0,0,0,0.8);
            border-top: 2px solid rgba(255,255,255,0.1);
            border-bottom: 2px solid rgba(255,255,255,0.1);
            margin-left: 50px;
            /* Animation Entrance */
            animation: slideIn 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }

        /* Garis dekorasi teknis */
        .hud-container::before {
            content: ''; position: absolute; top: -10px; right: -10px;
            width: 50px; height: 50px;
            border-top: 5px solid var(--primary);
            border-right: 5px solid var(--primary);
        }

        /* Un-skew content inside so text is readable */
        .hud-content {
            transform: skewX(10deg); /* Counter skew */
        }

        /* HEADER: HERO + NAME */
        .header-row {
            display: flex;
            align-items: center;
            border-bottom: 2px solid rgba(255,255,255,0.1);
            padding-bottom: 20px;
            margin-bottom: 20px;
        }

        .hero-frame {
            width: 130px; height: 130px;
            border: 3px solid var(--primary);
            background: #000;
            margin-right: 30px;
            position: relative;
            box-shadow: 0 0 20px rgba(255, 214, 0, 0.2);
        }
        
        .hero-frame img { width: 100%; height: 100%; object-fit: cover; }

        .lvl-tag {
            position: absolute; bottom: -10px; right: -10px;
            background: var(--primary); color: #000;
            font-weight: 900; font-size: 28px;
            padding: 2px 10px;
            border: 2px solid #fff;
        }

        .player-info h2 {
            font-size: 85px;
            line-height: 0.9;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 5px;
            text-shadow: 3px 3px 0px rgba(0,0,0,1);
        }
        
        .role-text {
            font-size: 24px; color: #aaa; letter-spacing: 5px; font-weight: bold;
        }

        /* STATS ROW */
        .stats-row {
            display: flex;
            gap: 60px;
            margin-bottom: 30px;
        }

        .stat-block .label { font-size: 24px; color: var(--primary); letter-spacing: 2px; margin-bottom: -5px;}
        .stat-block .value { font-size: 80px; font-weight: bold; line-height: 1; text-shadow: 0 0 20px rgba(255,255,255,0.2); }

        /* ITEMS ROW */
        .inventory-row {
            display: flex;
            align-items: center;
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 5px;
            border: 1px solid rgba(255,255,255,0.05);
        }

        .spell-slot { margin-right: 30px; padding-right: 30px; border-right: 2px solid rgba(255,255,255,0.2); }
        .spell-slot img { width: 65px; height: 65px; border: 2px solid var(--text-white); border-radius: 50%; }

        .items-grid { display: flex; gap: 10px; }
        .item-box {
            width: 65px; height: 65px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            position: relative;
            display: flex; align-items: center; justify-content: center;
        }
        
        /* Corner accent for items */
        .item-box::after {
            content: ''; position: absolute; bottom: 0; right: 0;
            width: 8px; height: 8px; background: var(--primary);
            clip-path: polygon(100% 0, 0 100%, 100% 100%);
        }

        .item-box img { width: 90%; height: 90%; object-fit: contain; }

        /* --- RIGHT PANEL (PLAYER PHOTO) --- */
        .player-visual {
            width: 45%;
            height: 100%;
            position: relative;
            display: flex;
            align-items: flex-end;
            justify-content: center;
        }

        #mvp-player-photo-img {
            height: 110%; /* Lebih besar dari container */
            margin-bottom: -50px;
            object-fit: contain;
            filter: drop-shadow(-20px 0px 30px rgba(0,0,0,0.8));
            /* Animasi masuk */
            animation: slideInRight 1s ease-out;
            mask-image: linear-gradient(to bottom, black 85%, transparent 100%);
            -webkit-mask-image: linear-gradient(to bottom, black 85%, transparent 100%);
        }

        /* Efek cahaya di belakang player */
        .player-glow {
            position: absolute;
            bottom: 0;
            width: 600px; height: 600px;
            background: radial-gradient(circle, var(--primary) 0%, rgba(0,0,0,0) 70%);
            opacity: 0.2;
            z-index: -1;
            mix-blend-mode: screen;
        }

        /* --- ANIMATIONS & COLORS --- */
        @keyframes slideIn {
            from { opacity: 0; transform: skewX(var(--angle)) translateX(-100px); }
            to { opacity: 1; transform: skewX(var(--angle)) translateX(0); }
        }
        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(100px); }
            to { opacity: 1; transform: translateX(0); }
        }

        /* Dynamic Coloring Classes */
        .blue-side { --primary: var(--blue-team); }
        .red-side { --primary: var(--red-team); }
        
        /* Glitch effect on text update */
        .glitch-anim { animation: flash 0.3s; }
        @keyframes flash {
            0% { opacity: 1; }
            50% { opacity: 0.5; color: #fff; text-shadow: 0 0 20px #fff; }
            100% { opacity: 1; }
        }

    </style>
</head>
<body>

    <div class="viewport" id="main-display">
        
        <div class="tech-grid"></div>
        <div class="big-watermark">MVP</div>

        <div class="content-layer">
            
            <div class="stats-panel">
                <div class="hud-container">
                    <div class="hud-content">
                        
                        <div class="header-row">
                            <div class="hero-frame">
                                <img id="mvp-hero-img" src="" alt="Hero">
                                <div class="lvl-tag">LV.<span id="mvp-lvl">15</span></div>
                            </div>
                            <div class="player-info">
                                <h2 id="mvp-nickname">NICKNAME</h2>
                                <div class="role-text">MOST VALUABLE PLAYER</div>
                            </div>
                        </div>

                        <div class="stats-row">
                            <div class="stat-block">
                                <div class="label">K / D / A</div>
                                <div class="value" id="mvp-kda">0/0/0</div>
                            </div>
                            <div class="stat-block">
                                <div class="label">GOLD</div>
                                <div class="value" id="mvp-gold">0</div>
                            </div>
                        </div>

                        <div class="inventory-row">
                            <div class="spell-slot" id="mvp-spell-container"></div>
                            <div class="items-grid" id="mvp-items-container">
                                </div>
                        </div>

                    </div>
                </div>
            </div>

            <div class="player-visual">
                <div class="player-glow"></div>
                <img id="mvp-player-photo-img" src="Assets/player/noplayer.png" alt="Player">
            </div>

        </div>
    </div>

    <script>
        const socket = new WebSocket(`ws://${window.location.host}`);
        const mainDisplay = document.getElementById('main-display');

        function fetchAndDisplayMvp() {
            fetch('/api/mvp')
                .then(response => {
                    if (!response.ok) {
                        console.warn(`[EndpointUnavailable] /api/mvp responded with status ${response.status}`);
                        return fetch('stubs/mvp.json');
                    }
                    return response;
                })
                .then(res => res.json())
                .then(data => {
                    updateMvpDisplay(data.mvp);
                })
                .catch(err => {
                    console.error("Gagal load MVP:", err);
                    fetch('stubs/mvp.json')
                        .then(res => res.json())
                        .then(data => updateMvpDisplay(data.mvp))
                        .catch(fallbackErr => console.error("Gagal load MVP fallback:", fallbackErr));
                });
        }

        function updateMvpDisplay(mvpData) {
            if (!mvpData) {
                mainDisplay.style.display = 'none';
                return;
            } else {
                mainDisplay.style.display = 'flex';
            }

            // Set Side Colors
            const viewport = document.querySelector('.viewport');
            viewport.classList.remove('blue-side', 'red-side');
            if(mvpData.side === 'blue') viewport.classList.add('blue-side');
            else viewport.classList.add('red-side');

            // Elements
            const heroImg = document.getElementById('mvp-hero-img');
            const playerPhotoImg = document.getElementById('mvp-player-photo-img');
            const nicknameEl = document.getElementById('mvp-nickname');
            const lvlEl = document.getElementById('mvp-lvl'); 
            const kdaEl = document.getElementById('mvp-kda');
            const goldEl = document.getElementById('mvp-gold');
            const spellContainer = document.getElementById('mvp-spell-container');
            const itemsContainer = document.getElementById('mvp-items-container');

            // Data injection with minimal safety checks
            heroImg.src = mvpData.heroImg || '';
            playerPhotoImg.src = mvpData.playerPhoto || 'Assets/player/noplayer.png';
            nicknameEl.textContent = mvpData.nickname || 'PLAYER';
            lvlEl.textContent = mvpData.stats.LVL || '1';
            kdaEl.textContent = mvpData.stats.KDA || '0/0/0';
            goldEl.textContent = mvpData.stats.GOLD || '0';

            // Items & Spell Rendering
            spellContainer.innerHTML = '';
            if (mvpData.stats.SPELL) {
                const img = document.createElement('img');
                img.src = `Assets/Itemandspell/${mvpData.stats.SPELL}.png`;
                img.onerror = () => img.style.display = 'none';
                spellContainer.appendChild(img);
            }

            itemsContainer.innerHTML = '';
            for (let i = 1; i <= 6; i++) {
                const box = document.createElement('div');
                box.className = 'item-box';
                const itemName = mvpData.stats[`ITEM ${i}`];
                if(itemName) {
                    const img = document.createElement('img');
                    img.src = `Assets/Itemandspell/${itemName}.png`;
                    img.onerror = () => img.style.display = 'none';
                    box.appendChild(img);
                }
                itemsContainer.appendChild(box);
            }

            // Retrigger Animation (Glitches text)
            nicknameEl.classList.remove('glitch-anim');
            void nicknameEl.offsetWidth; // trigger reflow
            nicknameEl.classList.add('glitch-anim');
        }

        socket.onopen = () => { console.log("WS Connected"); fetchAndDisplayMvp(); };
        socket.onmessage = (e) => {
            const msg = JSON.parse(e.data);
            if(msg.type === 'mvp_update') updateMvpDisplay(msg.data);
        };
        socket.onclose = () => setTimeout(() => window.location.reload(), 3000);
    </script>
</body>
</html>
